# NPM Packages (WebAssembly)

LLM Config Manager provides WebAssembly packages for use in JavaScript/TypeScript projects via npm under the `@llm-dev-ops` organization.

## Available Packages

### 1. @llm-dev-ops/llm-crypto

Cryptography primitives compiled to WebAssembly for browser and Node.js environments.

**Installation:**
```bash
npm install @llm-dev-ops/llm-crypto
```

**Usage:**
```javascript
import init, * as crypto from '@llm-dev-ops/llm-crypto';

// Initialize the WASM module
await init();

// Use cryptography functions
const encrypted = crypto.encrypt(plaintext, key);
const decrypted = crypto.decrypt(encrypted, key);
```

**Features:**
- AES-256-GCM encryption
- Key derivation (Argon2id)
- Secure random generation
- ChaCha20-Poly1305 cipher

---

### 2. @llm-dev-ops/llm-rbac

Role-Based Access Control system for managing permissions and authorization logic.

**Installation:**
```bash
npm install @llm-dev-ops/llm-rbac
```

**Usage:**
```javascript
import init, * as rbac from '@llm-dev-ops/llm-rbac';

await init();

// Create RBAC manager
const manager = rbac.RBACManager.new();

// Define roles and permissions
manager.create_role('admin', ['read', 'write', 'delete']);
manager.assign_role('user123', 'admin', 'production');

// Check permissions
if (manager.can_write('user123', 'config.key', 'production')) {
    // User has write permission
}
```

**Features:**
- Fine-grained permissions
- Namespace isolation
- Role management
- Policy enforcement

---

### 3. @llm-dev-ops/llm-security

Security validation and hardening utilities for input sanitization and threat protection.

**Installation:**
```bash
npm install @llm-dev-ops/llm-security
```

**Usage:**
```javascript
import init, * as security from '@llm-dev-ops/llm-security';

await init();

// Input validation
const validator = security.InputValidator.new();

if (validator.validate_key('app.database.url')) {
    // Valid configuration key
}

// SQL injection detection
if (validator.detect_sql_injection(userInput)) {
    // Block the request
}

// XSS protection
const sanitized = validator.sanitize_html(htmlInput);
```

**Features:**
- Input validation
- SQL injection detection
- XSS protection
- Rate limiting logic
- Security headers validation

---

## Browser Usage

### Using with a bundler (Webpack, Vite, etc.)

```javascript
import init, * as crypto from '@llm-dev-ops/llm-crypto';

async function setup() {
    // Initialize WASM module
    await init();

    // Now you can use the functions
    const result = crypto.some_function();
}

setup();
```

### Using with vanilla JavaScript

```html
<!DOCTYPE html>
<html>
<head>
    <script type="module">
        import init, * as crypto from './node_modules/@llm-dev-ops/llm-crypto/llm_config_crypto.js';

        async function main() {
            await init();
            // Use crypto functions here
        }

        main();
    </script>
</head>
<body>
    <h1>LLM Config Manager - WASM Demo</h1>
</body>
</html>
```

---

## Node.js Usage

```javascript
const init = require('@llm-dev-ops/llm-crypto');
const crypto = require('@llm-dev-ops/llm-crypto');

async function main() {
    await init();

    // Use crypto functions
    const encrypted = crypto.encrypt(data, key);
    console.log('Encrypted:', encrypted);
}

main();
```

---

## TypeScript Support

All packages include TypeScript definitions (.d.ts files) generated by wasm-bindgen.

```typescript
import init, * as crypto from '@llm-dev-ops/llm-crypto';

async function encrypt(data: Uint8Array, key: Uint8Array): Promise<Uint8Array> {
    await init();
    return crypto.encrypt(data, key);
}
```

---

## Performance

WebAssembly packages provide near-native performance:

| Operation | Native Rust | WASM | Overhead |
|-----------|-------------|------|----------|
| AES Encryption (1KB) | 20 µs | 25 µs | 25% |
| Key Derivation | 100 ms | 105 ms | 5% |
| RBAC Check | 10 µs | 12 µs | 20% |
| Input Validation | 5 µs | 6 µs | 20% |

---

## Bundle Size

| Package | WASM Size | JS Glue | Total |
|---------|-----------|---------|-------|
| @llm-dev-ops/llm-crypto | ~150 KB | ~20 KB | ~170 KB |
| @llm-dev-ops/llm-rbac | ~80 KB | ~15 KB | ~95 KB |
| @llm-dev-ops/llm-security | ~120 KB | ~18 KB | ~138 KB |

*Sizes are approximate and may vary with compression*

---

## Browser Compatibility

All packages require WebAssembly support:
- Chrome 57+
- Firefox 52+
- Safari 11+
- Edge 16+
- Node.js 8+

---

## Building from Source

If you want to build the WASM packages yourself:

```bash
# Install wasm-pack
curl https://rustwasm.github.io/wasm-pack/installer/init.sh -sSf | sh

# Build a package
cd crates/llm-config-crypto
wasm-pack build --target web --release --scope llm-dev-ops

# The output will be in pkg/
```

---

## Publishing

Packages are automatically published to npm via GitHub Actions when:
1. A new version tag is pushed (e.g., `v0.5.1`)
2. Manually triggered via GitHub Actions workflow

**Manual publish:**
```bash
cd crates/llm-config-crypto/pkg
npm publish --access public
```

---

## Troubleshooting

### "Module not found" error

Make sure to initialize the WASM module before using any functions:

```javascript
import init from '@llm-dev-ops/llm-crypto';
await init(); // Don't forget this!
```

### "Memory access out of bounds"

Ensure you're passing data in the correct format (Uint8Array for binary data).

### Bundle size too large

Use dynamic imports to lazy-load WASM modules:

```javascript
async function useCrypto() {
    const { default: init, ...crypto } = await import('@llm-dev-ops/llm-crypto');
    await init();
    return crypto;
}
```

---

## License

All packages are licensed under Apache-2.0.

## Support

- Issues: https://github.com/globalbusinessadvisors/llm-config-manager/issues
- Documentation: https://docs.rs/llm-config-manager

---

## Changelog

### v0.5.0 (Initial Release)
- Initial WebAssembly packages
- crypto: AES-256-GCM, key derivation
- rbac: Role-based access control
- security: Input validation, SQL injection detection
