apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "llm-config-manager.configMapName" . }}
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "llm-config-manager.labels" . | nindent 4 }}
    app.kubernetes.io/component: configuration
data:
  # Server configuration
  SERVER_HOST: {{ .Values.config.serverHost | quote }}
  SERVER_PORT: {{ .Values.config.serverPort | quote }}
  SERVER_WORKERS: {{ .Values.config.serverWorkers | quote }}

  # Metrics configuration
  METRICS_ENABLED: {{ .Values.config.metricsEnabled | quote }}
  METRICS_PORT: {{ .Values.config.metricsPort | quote }}

  # Cache configuration
  CACHE_L1_SIZE: {{ .Values.config.cacheL1Size | quote }}
  CACHE_L1_TTL_SECONDS: {{ .Values.config.cacheL1TtlSeconds | quote }}
  CACHE_L2_ENABLED: {{ .Values.config.cacheL2Enabled | quote }}

  # Storage configuration
  STORAGE_TYPE: {{ .Values.config.storageType | quote }}
  STORAGE_POOL_SIZE: {{ .Values.config.storagePoolSize | quote }}

  # Audit configuration
  AUDIT_ENABLED: {{ .Values.config.auditEnabled | quote }}
  AUDIT_RETENTION_DAYS: {{ .Values.config.auditRetentionDays | quote }}
  AUDIT_BATCH_SIZE: {{ .Values.config.auditBatchSize | quote }}

  # Environment
  RUST_LOG: {{ .Values.config.rustLog | quote }}
  LLM_CONFIG_ENVIRONMENT: {{ .Values.config.environment | quote }}

  # Feature flags
  ENABLE_RBAC: {{ .Values.config.enableRbac | quote }}
  ENABLE_ENCRYPTION: {{ .Values.config.enableEncryption | quote }}
  ENABLE_AUDIT: {{ .Values.config.enableAudit | quote }}
  ENABLE_CACHE: {{ .Values.config.enableCache | quote }}

  # Directories
  DATA_DIR: "/var/lib/llm-config/data"
  CACHE_DIR: "/var/lib/llm-config/cache"
  BACKUP_DIR: "/var/lib/llm-config/backups"
  LOG_DIR: "/var/log/llm-config"

  # Database configuration (non-sensitive)
  DATABASE_NAME: {{ .Values.postgresql.auth.database | quote }}
  DATABASE_USER: {{ .Values.postgresql.auth.username | quote }}
  DATABASE_PORT: "5432"
  DATABASE_MAX_CONNECTIONS: "20"

  # Redis configuration (non-sensitive)
  REDIS_PORT: "6379"
  REDIS_POOL_SIZE: "10"
